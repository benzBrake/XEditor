(function(){var t,e=[].slice;t=function(){var t,n,r,s,l,i,o,a;function c(){this.commonWhiteList="kbd|b|i|strong|em|sup|sub|br|code|del|a|hr|small",this.blockHtmlTags="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|address|form|fieldset|iframe|hr|legend|article|section|nav|aside|hgroup|header|footer|figcaption|svg|script|noscript",this.specialWhiteList={table:"table|tbody|thead|tfoot|tr|td|th"},this.hooks={},this.html=!1,this.line=!1,this.blockParsers=[["code",10],["shtml",20],["pre",30],["ahtml",40],["shr",50],["list",60],["math",70],["html",80],["footnote",90],["definition",100],["quote",110],["table",120],["sh",130],["mh",140],["dhr",150],["default",9999]],this.parsers={}}return a=function(t){return t.charAt(0).toUpperCase()+t.substring(1)},l=function(t){return t.replace(/[-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},s="A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",i=function(t,e,n){var r,s,o,a,c,h;if(t instanceof Array)if(e instanceof Array)for(r=s=0,a=t.length;s<a;r=++s)h=t[r],n=i(h,e[r],n);else for(o=0,c=t.length;o<c;o++)h=t[o],n=i(h,e,n);else t=l(t),n=n.replace(new RegExp(t,"g"),e.replace(/\$/g,"$$$$"));return n},r=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},o=function(t,e){var n,r,s,i,o;if(null==e&&(e=null),null!=e){for(o="",r=s=0,i=e.length-1;0<=i?s<=i:s>=i;r=0<=i?++s:--s)n=e[r],o+=n=l(n);return o="["+o+"]*",t.replace(new RegExp("^"+o),"").replace(new RegExp(o+"$"),"")}return t.replace(/^\s*/,"").replace(/\s*$/,"")},t=function(t){var e,n,r,s;if(s=[],t instanceof Array)for(n=e=0,r=t.length;e<r;n=++e)t[n],s.push(n);else for(n in t)s.push(n);return s},n=function(t){var e,n,r,s,l;if(s=[],t instanceof Array)for(n=0,r=t.length;n<r;n++)l=t[n],s.push(l);else for(e in t)l=t[e],s.push(l);return s},c.prototype.makeHtml=function(t){var e,n,r,s,l,i;for(this.footnotes=[],this.definitions={},this.holders={},this.uniqid=Math.ceil(1e7*Math.random())+Math.ceil(1e7*Math.random()),this.id=0,this.blockParsers.sort((function(t,e){return t[1]<e[1]?-1:1})),n=0,r=(i=this.blockParsers).length;n<r;n++)s=(l=i[n])[0],void 0!==l[2]?this.parsers[s]=l[2]:this.parsers[s]=this["parseBlock"+a(s)].bind(this);return t=this.initText(t),e=this.parse(t),e=this.makeFootnotes(e),e=this.optimizeLines(e),this.call("makeHtml",e)},c.prototype.enableHtml=function(t){this.html=null==t||t},c.prototype.enableLine=function(t){this.line=null==t||t},c.prototype.hook=function(t,e){return null==this.hooks[t]&&(this.hooks[t]=[]),this.hooks[t].push(e)},c.prototype.makeHolder=function(t){var e;return e="|\r"+this.uniqid+this.id+"\r|",this.id+=1,this.holders[e]=t,e},c.prototype.initText=function(t){return t.replace(/\t/g,"    ").replace(/\r/g,"").replace(/(\u000A|\u000D|\u2028|\u2029)/g,"\n")},c.prototype.makeFootnotes=function(t){var e,n;if(this.footnotes.length>0){for(t+='<div class="footnotes"><hr><ol>',e=1;n=this.footnotes.shift();)"string"==typeof n?n+=' <a href="#fnref-'+e+'" class="footnote-backref">&#8617;</a>':(n[n.length-1]+=' <a href="#fnref-'+e+'" class="footnote-backref">&#8617;</a>',n=n.length>1?this.parse(n.join("\n")):this.parseInline(n[0])),t+='<li id="fn-'+e+'">'+n+"</li>",e+=1;t+="</ol></div>"}return t},c.prototype.parse=function(t,e,n){var r,s,l,i,o,c,h,p,u,f,k,m,g;for(null==e&&(e=!1),null==n&&(n=0),p=[],s=this.parseBlock(t,p),o="",e&&1===s.length&&"normal"===s[0][0]&&(s[0][3]=!0),c=0,h=s.length;c<h;c++)m=(r=s[c])[0],k=r[1],l=r[2],g=r[3],i=p.slice(k,l+1),u="parse"+a(m),i=this.call("before"+a(u),i,g),f=this[u](i,g,k+n,l+n),o+=f=this.call("after"+a(u),f,g);return o},c.prototype.call=function(){var t,n,r,s,l,i;if(l=arguments[0],i=(t=2<=arguments.length?e.call(arguments,1):[])[0],null==this.hooks[l])return i;for(n=0,r=(s=this.hooks[l]).length;n<r;n++)i=s[n].apply(this,t),t[0]=i;return i},c.prototype.releaseHolder=function(e,r){var s;for(null==r&&(r=!0),s=0;e.indexOf("\r")>=0&&s<10;)e=i(t(this.holders),n(this.holders),e),s+=1;return r&&(this.holders={}),e},c.prototype.markLine=function(t,e){return null==e&&(e=-1),this.line?'<span class="line" data-start="'+t+'" data-end="'+(e=e<0?t:e)+'" data-id="'+this.uniqid+'"></span>':""},c.prototype.markLines=function(t,e){var n,r;return n=-1,this.line?t.map((r=this,function(t){return n+=1,r.markLine(e+n)+t})):t},c.prototype.optimizeLines=function(t){var n,r;return n=0,r=new RegExp('class="line" data\\-start="([0-9]+)" data\\-end="([0-9]+)" (data\\-id="'+this.uniqid+'")',"g"),this.line?t.replace(r,(function(){var t,r;return t=1<=arguments.length?e.call(arguments,0):[],r=n!==parseInt(t[1])?'class="line" data-start="'+n+'" data-start-original="'+t[1]+'" data-end="'+t[2]+'" '+t[3]:t[0],n=1+parseInt(t[2]),r})):t},c.prototype.parseInline=function(t,n,l,o){var a,c;return null==n&&(n=""),null==l&&(l=!0),null==o&&(o=!0),t=(t=this.call("beforeParseInline",t)).replace(/(^|[^\\])(`+)(.+?)\2/gm,(c=this,function(){var t;return(t=1<=arguments.length?e.call(arguments,0):[])[1]+c.makeHolder("<code>"+r(t[3])+"</code>")})),t=t.replace(/(^|[^\\])(\$+)(.+?)\2/gm,function(t){return function(){var n;return(n=1<=arguments.length?e.call(arguments,0):[])[1]+t.makeHolder(n[2]+r(n[3])+n[2])}}(this)),t=t.replace(/\\(.)/g,function(t){return function(){var n,s,l;return l=(s=1<=arguments.length?e.call(arguments,0):[])[1].match(/^[-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]$/)?"":"\\",n=(n=r(s[1])).replace(/\$/g,"&dollar;"),t.makeHolder(l+n)}}(this)),t=t.replace(/<(https?:\/\/.+)>/gi,function(t){return function(){var n,r,s;return r=1<=arguments.length?e.call(arguments,0):[],s=t.cleanUrl(r[1]),n=t.call("parseLink",r[1]),t.makeHolder('<a href="'+s+'">'+n+"</a>")}}(this)),t=t.replace(/<(\/?)([a-z0-9-]+)(\s+[^>]*)?>/gi,function(t){return function(){var s;return s=1<=arguments.length?e.call(arguments,0):[],t.html||("|"+t.commonWhiteList+"|"+n+"|").indexOf("|"+s[2].toLowerCase()+"|")>=0?t.makeHolder(s[0]):t.makeHolder(r(s[0]))}}(this)),this.html&&(t=t.replace(/<!\-\-(.*?)\-\->/g,function(t){return function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],t.makeHolder(n[0])}}(this))),t=(t=i(["<",">"],["&lt;","&gt;"],t)).replace(/\[\^((?:[^\]]|\\\]|\\\[)+?)\]/g,function(t){return function(){var n,r;return r=1<=arguments.length?e.call(arguments,0):[],(n=t.footnotes.indexOf(r[1]))<0&&(n=t.footnotes.length+1,t.footnotes.push(t.parseInline(r[1],"",!1))),t.makeHolder('<sup id="fnref-'+n+'"><a href="#fn-'+n+'" class="footnote-ref">'+n+"</a></sup>")}}(this)),t=t.replace(/!\[((?:[^\]]|\\\]|\\\[)*?)\]\(((?:[^\)]|\\\)|\\\()+?)\)/g,function(t){return function(){var n,s,l;return s=1<=arguments.length?e.call(arguments,0):[],n=r(t.escapeBracket(s[1])),l=t.escapeBracket(s[2]),l=t.cleanUrl(l),t.makeHolder('<img src="'+l+'" alt="'+n+'" title="'+n+'">')}}(this)),t=t.replace(/!\[((?:[^\]]|\\\]|\\\[)*?)\]\[((?:[^\]]|\\\]|\\\[)+?)\]/g,function(t){return function(){var n,s,l;return s=1<=arguments.length?e.call(arguments,0):[],n=r(t.escapeBracket(s[1])),l=null!=t.definitions[s[2]]?'<img src="'+t.definitions[s[2]]+'" alt="'+n+'" title="'+n+'">':n,t.makeHolder(l)}}(this)),t=t.replace(/\[((?:[^\]]|\\\]|\\\[)+?)\]\(((?:[^\)]|\\\)|\\\()+?)\)/g,function(t){return function(){var n,r,s;return r=1<=arguments.length?e.call(arguments,0):[],n=t.parseInline(t.escapeBracket(r[1]),"",!1,!1),s=t.escapeBracket(r[2]),s=t.cleanUrl(s),t.makeHolder('<a href="'+s+'">'+n+"</a>")}}(this)),t=t.replace(/\[((?:[^\]]|\\\]|\\\[)+?)\]\[((?:[^\]]|\\\]|\\\[)+?)\]/g,function(t){return function(){var n,r,s;return r=1<=arguments.length?e.call(arguments,0):[],n=t.parseInline(t.escapeBracket(r[1]),"",!1,!1),s=null!=t.definitions[r[2]]?'<a href="'+t.definitions[r[2]]+'">'+n+"</a>":n,t.makeHolder(s)}}(this)),t=(t=this.parseInlineCallback(t)).replace(/<([_a-z0-9-\.\+]+@[^@]+\.[a-z]{2,})>/gi,'<a href="mailto:$1">$1</a>'),o&&(a=new RegExp('(^|[^"])((https?):['+s+'_0-9-\\./%#!@\\?\\[\\]\\+=~\\|\\,&\\(\\)]+)($|[^"])',"ig"),t=t.replace(a,function(t){return function(){var n,r;return r=1<=arguments.length?e.call(arguments,0):[],n=t.call("parseLink",r[2]),r[1]+'<a href="'+r[2]+'">'+n+"</a>"+r[4]}}(this))),t=this.call("afterParseInlineBeforeRelease",t),t=this.releaseHolder(t,l),t=this.call("afterParseInline",t)},c.prototype.parseInlineCallback=function(t){var n;return t=t.replace(/(\*{3})((?:.|\r)+?)\1/gm,(n=this,function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],"<strong><em>"+n.parseInlineCallback(t[2])+"</em></strong>"})),t=t.replace(/(\*{2})((?:.|\r)+?)\1/gm,function(t){return function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],"<strong>"+t.parseInlineCallback(n[2])+"</strong>"}}(this)),t=t.replace(/(\*)((?:.|\r)+?)\1/gm,function(t){return function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],"<em>"+t.parseInlineCallback(n[2])+"</em>"}}(this)),t=t.replace(/(\s+|^)(_{3})((?:.|\r)+?)\2(\s+|$)/gm,function(t){return function(){var n;return(n=1<=arguments.length?e.call(arguments,0):[])[1]+"<strong><em>"+t.parseInlineCallback(n[3])+"</em></strong>"+n[4]}}(this)),t=t.replace(/(\s+|^)(_{2})((?:.|\r)+?)\2(\s+|$)/gm,function(t){return function(){var n;return(n=1<=arguments.length?e.call(arguments,0):[])[1]+"<strong>"+t.parseInlineCallback(n[3])+"</strong>"+n[4]}}(this)),t=t.replace(/(\s+|^)(_)((?:.|\r)+?)\2(\s+|$)/gm,function(t){return function(){var n;return(n=1<=arguments.length?e.call(arguments,0):[])[1]+"<em>"+t.parseInlineCallback(n[3])+"</em>"+n[4]}}(this)),t=t.replace(/(~{2})((?:.|\r)+?)\1/gm,function(t){return function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],"<del>"+t.parseInlineCallback(n[2])+"</del>"}}(this)),t},c.prototype.parseBlock=function(e,n){var r,s,l,i,o,a,c,h,p,u,f,k;for(s=0,o=(u=e.split("\n")).length;s<o;s++)c=u[s],n.push(c);for(this.blocks=[],this.current="normal",this.pos=-1,k={special:t(this.specialWhiteList).join("|"),empty:0,html:!1},l=i=0,a=n.length;i<a;l=++i)if(c=n[l],null!=(r=this.getBlock())&&(r=r.slice(0)),"normal"===this.current||this.parsers[this.current](r,l,c,k,n))for(h in f=this.parsers)if(p=f[h],h!==this.current&&!p(r,l,c,k,n))break;return this.optimizeBlocks(this.blocks,n)},c.prototype.parseBlockList=function(t,e,n,r){var s,l;if(this.isBlock("list")&&!n.match(/^\s*\[((?:[^\]]|\\\]|\\\[)+?)\]:\s*(.+)$/)){if(r.empty<=1&&(s=n.match(/^(\s+)/))&&s[1].length>t[3])return r.empty=0,this.setBlock(e),!1;if(n.match(/^\s*$/)&&0===r.empty)return r.empty+=1,this.setBlock(e),!1}return!(s=n.match(/^(\s*)((?:[0-9]+\.)|\-|\+|\*)\s+/i))||(l=s[1].length,r.empty=0,this.isBlock("list")?this.setBlock(e,l):this.startBlock("list",e,l),!1)},c.prototype.parseBlockCode=function(t,e,n){var r,s,l;return(s=n.match(/^(\s*)(~{3,}|`{3,})([^`~]*)$/i))?(this.isBlock("code")?(r=t[3][2])?this.combineBlock().setBlock(e):this.setBlock(e).endBlock():(r=!1,this.isBlock("list")&&(r=(l=t[3])>0&&s[1].length>=l||s[1].length>l),this.startBlock("code",e,[s[1],s[3],r])),!1):!this.isBlock("code")||(this.setBlock(e),!1)},c.prototype.parseBlockShtml=function(t,e,n,r){return n.match(/^(\s*)!!!(\s*)$/)?(this.isBlock("shtml")?this.setBlock(e).endBlock():this.startBlock("shtml",e),!1):!this.isBlock("shtml")||(this.setBlock(e),!1)},c.prototype.parseBlockAhtml=function(t,e,n,r){var s,l,i,o,a;if(this.html)if(l=new RegExp("^\\s*<("+this.blockHtmlTags+")(\\s+[^>]*)?>","i"),a=n.match(l)){if(this.isBlock("ahtml"))return this.setBlock(e),!1;if(void 0===a[2]||"/"!==a[2]){for(this.startBlock("ahtml",e),s=new RegExp("\\s*<("+this.blockHtmlTags+")(\\s+[^>]*)?>","ig");o=s.exec(n);)i=o[1];return 0<=n.indexOf("</"+i+">")?this.endBlock():r.html=i,!1}}else{if(r.html&&0<=n.indexOf("</"+r.html+">"))return this.setBlock(e).endBlock(),r.html=!1,!1;if(this.isBlock("ahtml"))return this.setBlock(e),!1;if(a=n.match(/^\s*<!\-\-(.*?)\-\->\s*$/))return this.startBlock("ahtml",e).endBlock(),!1}return!0},c.prototype.parseBlockMath=function(t,e,n){return n.match(/^(\s*)\$\$(\s*)$/)?(this.isBlock("math")?this.setBlock(e).endBlock():this.startBlock("math",e),!1):!this.isBlock("math")||(this.setBlock(e),!1)},c.prototype.parseBlockPre=function(t,e,n,r){return n.match(/^ {4}/)?(this.isBlock("pre")?this.setBlock(e):this.startBlock("pre",e),!1):!this.isBlock("pre")||!n.match(/^\s*$/)||(this.setBlock(e),!1)},c.prototype.parseBlockHtml=function(t,e,n,r){var s,l;return(s=n.match(new RegExp("^\\s*<("+r.special+")(\\s+[^>]*)?>","i")))?(l=s[1].toLowerCase(),this.isBlock("html",l)||this.isBlock("pre")||this.startBlock("html",e,l),!1):(s=n.match(new RegExp("</("+r.special+")>\\s*$","i")))?(l=s[1].toLowerCase(),this.isBlock("html",l)&&this.setBlock(e).endBlock(),!1):!this.isBlock("html")||(this.setBlock(e),!1)},c.prototype.parseBlockFootnote=function(t,e,n){var r,s;return!(r=n.match(/^\[\^((?:[^\]]|\\\]|\\\[)+?)\]:/))||(s=r[0].length-1,this.startBlock("footnote",e,[s,r[1]]),!1)},c.prototype.parseBlockDefinition=function(t,e,n){var r;return!(r=n.match(/^\s*\[((?:[^\]]|\\\]|\\\[)+?)\]:\s*(.+)$/))||(this.definitions[r[1]]=this.cleanUrl(r[2]),this.startBlock("definition",e).endBlock(),!1)},c.prototype.parseBlockQuote=function(t,e,n){var r;return!(r=n.match(/^(\s*)>/))||(this.isBlock("list")&&r[1].length>0||this.isBlock("quote")?this.setBlock(e):this.startBlock("quote",e),!1)},c.prototype.parseBlockTable=function(t,e,n,r,s){var l,i,o,a,c,h,p;if(h=n.match(/^((?:(?:(?:\||\+)(?:[ :]*\-+[ :]*)(?:\||\+))|(?:(?:[ :]*\-+[ :]*)(?:\||\+)(?:[ :]*\-+[ :]*))|(?:(?:[ :]*\-+[ :]*)(?:\||\+))|(?:(?:\||\+)(?:[ :]*\-+[ :]*)))+)$/)){if(this.isBlock("table"))t[3][0].push(t[3][2]),t[3][2]+=1,this.setBlock(e,t[3]);else{for(o=0,null==t||"normal"!==t[0]||s[t[2]].match(/^\s*$/)?this.startBlock("table",e):(o=1,this.backBlock(1,"table")),"|"===h[1][0]&&(h[1]=h[1].substring(1),"|"===h[1][h[1].length-1]&&(h[1]=h[1].substring(0,h[1].length-1))),i=[],a=0,c=(p=h[1].split(/\+|\|/)).length;a<c;a++)l="none",(h=p[a].match(/^\s*(:?)\-+(:?)\s*$/))&&(h[1]&&h[2]?l="center":h[1]?l="left":h[2]&&(l="right")),i.push(l);this.setBlock(e,[[o],i,o+1])}return!1}return!0},c.prototype.parseBlockSh=function(t,e,n){var r,s;return!(r=n.match(/^(#+)(.*)$/))||(s=Math.min(r[1].length,6),this.startBlock("sh",e,s).endBlock(),!1)},c.prototype.parseBlockMh=function(t,e,n,r,s){var l;return!((l=n.match(/^\s*((=|-){2,})\s*$/))&&null!=t&&"normal"===t[0]&&!s[t[2]].match(/^\s*$/))||(this.isBlock("normal")?this.backBlock(1,"mh","="===l[1][0]?1:2).setBlock(e).endBlock():this.startBlock("normal",e),!1)},c.prototype.parseBlockShr=function(t,e,n){return!n.match(/^(\* *){3,}\s*$/)||(this.startBlock("hr",e).endBlock(),!1)},c.prototype.parseBlockDhr=function(t,e,n){return!n.match(/^(- *){3,}\s*$/)||(this.startBlock("hr",e).endBlock(),!1)},c.prototype.parseBlockDefault=function(t,e,n,r){return this.isBlock("footnote")?n.match(/^(\s*)/)[1].length>=t[3][0]?this.setBlock(e):this.startBlock("normal",e):this.isBlock("table")?0<=n.indexOf("|")?(t[3][2]+=1,this.setBlock(e,t[3])):this.startBlock("normal",e):this.isBlock("quote")?n.match(/^(\s*)$/)?this.startBlock("normal",e):this.setBlock(e):null==t||"normal"!==t[0]?this.startBlock("normal",e):this.setBlock(e),!0},c.prototype.optimizeBlocks=function(t,e){var n,r,s,l,i,o,a,c,h,p,u;for(r=t.slice(0),i=e.slice(0),r=this.call("beforeOptimizeBlocks",r,i),l=0;null!=r[l];)o=!1,n=r[l],c=null!=r[l-1]?r[l-1]:null,a=null!=r[l+1]?r[l+1]:null,p=n[0],s=n[1],h=n[2],"pre"===p&&i.slice(n[1],n[2]+1).reduce((function(t,e){return e.match(/^\s*$/)&&t}),!0)&&(n[0]=p="normal"),"normal"===p&&(u=["list","quote"],s===h&&i[s].match(/^\s*$/)&&null!=c&&null!=a&&c[0]===a[0]&&u.indexOf(c[0])>=0&&(r[l-1]=[c[0],c[1],a[2],null],r.splice(l,2),o=!0)),o||(l+=1);return this.call("afterOptimizeBlocks",r,i)},c.prototype.parseCode=function(t,e,n){var s,l,i,a,c,h;return s=e[0],a=e[1],a=o(a),l=s.length,a.match(/^[_a-z0-9-\+\#\:\.]+$/i)?(e=a.split(":")).length>1&&(a=e[0],c=e[1],a=o(a),c=o(c)):a=null,i=!0,t=t.slice(1,-1).map((function(t){return t=t.replace(new RegExp("/^[ ]{"+l+"}/"),""),i&&!t.match(/^\s*$/)&&(i=!1),r(t)})),h=this.markLines(t,n+1).join("\n"),i?"":"<pre><code"+(a?' class="language-'+a+'"':"")+(c?' rel="'+c+'"':"")+">"+h+"</code></pre>"},c.prototype.parsePre=function(t,e,n){var s;return t=t.map((function(t){return r(t.substring(4))})),(s=this.markLines(t,n).join("\n")).match(/^\s*$/)?"":"<pre><code>"+s+"</code></pre>"},c.prototype.parseAhtml=function(t,e,n){return o(this.markLines(t,n).join("\n"))},c.prototype.parseShtml=function(t,e,n){return o(this.markLines(t.slice(1,-1),n+1).join("\n"))},c.prototype.parseMath=function(t,e,n,s){return"<p>"+this.markLine(n,s)+r(t.join("\n"))+"</p>"},c.prototype.parseSh=function(t,e,n,r){var s;return(s=this.markLine(n,r)+this.parseInline(o(t[0],"# "))).match(/^\s*$/)?"":"<h"+e+">"+s+"</h"+e+">"},c.prototype.parseMh=function(t,e,n,r){return this.parseSh(t,e,n,r)},c.prototype.parseQuote=function(t,e,n){var r;return(r=(t=t.map((function(t){return t.replace(/^\s*> ?/,"")}))).join("\n")).match(/^\s*$/)?"":"<blockquote>"+this.parse(r,!0,n)+"</blockquote>"},c.prototype.parseList=function(t,e,n){var r,s,l,i,o,a,c,h,p,u,f,k,m,g,d,B,b,y,v,$;for(s="",m=99999,b=99999,r=!1,B=!1,d=[],i=l=0,p=t.length;l<p;i=++l)(k=(f=t[i]).match(/^(\s*)((?:[0-9]+\.?)|\-|\+|\*)(\s+)(.*)$/i))?(y=k[1].length,$=0<="+-*".indexOf(k[2])?"ul":"ol",m=Math.min(y,m),r=!0,y>0&&(b=Math.min(y,b),B=!0),d.push([y,$,f,k[4]])):(d.push(f),(k=f.match(/^(\s*)/))&&(y=k[1].length)>0&&(b=Math.min(y,b),B=!0));for(m=r?m:0,b=B?b:m,a="",c=[],h=0,i=o=0,u=d.length;o<u;i=++o)(g=d[i])instanceof Array?(y=g[0],$=g[1],f=g[2],v=g[3],y!==m?c.push(f.replace(new RegExp("^\\s{"+b+"}"),"")):(c.length>0&&(s+="<li>"+this.parse(c.join("\n"),!0,n+h)+"</li>"),a!==$&&(a&&(s+="</"+a+">"),s+="<"+$+">"),h=i,c=[v],a=$)):c.push(g.replace(new RegExp("^\\s{"+b+"}"),""));return c.length>0&&(s+="<li>"+this.parse(c.join("\n"),!0,n+h)+"</li></"+a+">"),s},c.prototype.parseTable=function(t,e,n){var r,s,l,i,a,c,h,p,u,f,k,m,g,d,B,b,y,v,$,x;for(h=e[0],r=e[1],c="<table>",s=!(a=h.length>0&&h.reduce((function(t,e){return e+t}))>0)||null,b=!1,u=p=0,m=t.length;p<m;u=++p)if(d=t[u],0<=h.indexOf(u))a&&b&&(a=!1,s=!0);else{for(b=!0,"|"===(d=o(d))[0]&&"|"===(d=d.substring(1))[d.length-1]&&(d=d.substring(0,d.length-1)),v=d.split("|").map((function(t){return t.match(/^\s*$/)?" ":o(t)})),i={},k=-1,f=0,g=v.length;f<g;f++)(y=v[f]).length>0?i[k+=1]=[null!=i[k]?i[k][0]+1:1,y]:null!=i[k]?i[k][0]+=1:i[0]=[1,y];for(u in a?c+="<thead>":s&&(c+="<tbody>"),c+="<tr",this.line&&(c+=' class="line" data-start="'+(n+u)+'" data-end="'+(n+u)+'" data-id="'+this.uniqid+'"'),c+=">",i)B=(l=i[u])[0],x=l[1],c+="<"+($=a?"th":"td"),B>1&&(c+=' colspan="'+B+'"'),null!=r[u]&&"none"!==r[u]&&(c+=' align="'+r[u]+'"'),c+=">"+this.parseInline(x)+"</"+$+">";c+="</tr>",a?c+="</thead>":s&&(s=!1)}return null!==s&&(c+="</tbody>"),c+"</table>"},c.prototype.parseHr=function(t,e,n){return this.line?'<hr class="line" data-start="'+n+'" data-end="'+n+'">':"<hr>"},c.prototype.parseNormal=function(t,e,n){var r,s,l;return null==e&&(e=!1),r=0,t=t.map((l=this,function(t){return(t=l.parseInline(t)).match(/^\s*$/)||(t=l.markLine(n+r)+t),r+=1,t})),(s=(s=(s=o(t.join("\n"))).replace(/(\n\s*){2,}/g,"</p><p>")).replace(/\n/g,"<br>")).match(/^\s*$/)?"":e?s:"<p>"+s+"</p>"},c.prototype.parseFootnote=function(t,e){var n,r;return e[0],r=e[1],(n=this.footnotes.indexOf(r))>=0&&((t=t.slice(0))[0]=t[0].replace(/^\[\^((?:[^\]]|\]|\[)+?)\]:/,""),this.footnotes[n]=t),""},c.prototype.parseDefinition=function(){return""},c.prototype.parseHtml=function(t,e,n){var r;return t=t.map((r=this,function(t){return r.parseInline(t,null!=r.specialWhiteList[e]?r.specialWhiteList[e]:"")})),this.markLines(t,n).join("\n")},c.prototype.cleanUrl=function(t){var e,n,r;return n=new RegExp("^\\s*((http|https|ftp|mailto):["+s+"_a-z0-9-:\\.\\*/%#;!@\\?\\[\\]\\+=~\\|\\,&\\(\\)]+)","i"),r=new RegExp("^\\s*(["+s+"_a-z0-9-:\\.\\*/%#!@\\?\\+=~\\|\\,&]+)","i"),(e=t.match(n))||(e=t.match(r))?e[1]:"#"},c.prototype.escapeBracket=function(t){return i(["\\[","\\]","\\(","\\)"],["[","]","(",")"],t)},c.prototype.startBlock=function(t,e,n){return null==n&&(n=null),this.pos+=1,this.current=t,this.blocks.push([t,e,e,n]),this},c.prototype.endBlock=function(){return this.current="normal",this},c.prototype.isBlock=function(t,e){return null==e&&(e=null),this.current===t&&(null===e||this.blocks[this.pos][3]===e)},c.prototype.getBlock=function(){return null!=this.blocks[this.pos]?this.blocks[this.pos]:null},c.prototype.setBlock=function(t,e){return null==t&&(t=null),null==e&&(e=null),null!==t&&(this.blocks[this.pos][2]=t),null!==e&&(this.blocks[this.pos][3]=e),this},c.prototype.backBlock=function(t,e,n){var r,s;return null==n&&(n=null),this.pos<0?this.startBlock(e,0,n):(s=this.blocks[this.pos][2],this.blocks[this.pos][2]=s-t,r=[e,s-t+1,s,n],this.blocks[this.pos][1]<=this.blocks[this.pos][2]?(this.pos+=1,this.blocks.push(r)):this.blocks[this.pos]=r,this.current=e,this)},c.prototype.combineBlock=function(){var t,e;return this.pos<1||(e=this.blocks[this.pos-1].slice(0),t=this.blocks[this.pos].slice(0),e[2]=t[2],this.blocks[this.pos-1]=e,this.current=e[0],this.blocks=this.blocks.slice(0,-1),this.pos-=1),this},c}(),"undefined"!=typeof module&&null!==module?module.exports=t:"undefined"!=typeof window&&null!==window&&(window.HyperDown=t)}).call(this);
